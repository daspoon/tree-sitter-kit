# TreeSitterKit

This project aims to simplify the use of the tree-sitter parser generator for implementing custom programming languages in Swift.
See the following links for more information on tree-sitter:
  - Github project: https://github.com/tree-sitter/tree-sitter
  - Intro video: https://news.ycombinator.com/item?id=18213022
  - Getting started: https://tree-sitter.github.io/tree-sitter


## Goals

1) Provide a means to integrate a tree-sitter parser into a Swift package which implements a custom language.

This is currently approximated by creating a c-language target containing a grammar.js and a parser.c generated by the tree-sitter cli.
Generation is currently performed by the command plugin TreeSitterGen, and the FunLang target provides a simple example;
its parser can be (re)generated by executing the following from the package directory:

    $ swift package generate-parser --target FunLang 


2) Provide a correlation between grammar.js and the Swift data types which represent the abstract syntax of a custom language.

The tree-sitter api provides means to translate text into generic syntax trees, and to traverse and interpret those trees by examining their metadata.
Translation to a Swift data type requires a custom translation not wholey unlike parsing; this is seen in FunLangTests where Expr provides the abstract syntax for the grammar of FunLang.
We aim to provide a unified expression which is translated (via Swift macros) into the necessary components:
  - grammar.js
  - type definitions for the abstract syntax
  - methods to translate tree-sitter nodes to abstract syntax


## Misc Todo

### break the test language out as a separate package

This is indicative of the intended use case; the package should have three targets
  - the 'language', containing grammar.js et.al.
  - the 'term logic', containing the syntax datatype (e.g. Expr) along with methods for parsing and evaluation
  - the unit tests for parsing and evaluation

### extend generator tool to create include/language.h containing the following... 
    ```
    #include <tree_sitter/api.h>
    TSLanguage *tree_sitter_mylang();
    ```
    where mylang is the language name extracted from grammar.js

### enable support for custom operators with names, fixity and precedence defined dynamically

### make STNode conform to Sequence


## Notes

While existing packages (https://github.com/ChimeHQ/SwiftTreeSitter and https://github.com/viktorstrate/swift-tree-sitter) provide Swift bindings for tree-sitter APIs, they do not directly support building custom language targets.
Further, these packages bundle parsers for various existing languages which are not required for our purposes; ideally a language parser should be provided as a package independent of the tree-sitter API bindings.
